# Домашнее задание к занятию "Типы и структура СУБД" - `Александр Недорезов`

### Задача 1
Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определённых данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- электронные чеки в json-виде,
- склады и автомобильные дороги для логистической компании,
- генеалогические деревья,
- кэш идентификаторов клиентов с ограниченным временем жизни для движка аутентификации,
- отношения клиент-покупка для интернет-магазина.

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.


> #### Ответ:
> **- электронные чеки в json-виде**  
> Документо-ориентированные БД NoSQL (например, MongoDB), так как данные не структурированы, позиции в чеке заранее не известны. 
> 
> **- склады и автомобильные дороги для логистической компании**  
> Графовые БД (Neo4j) - созданы для этого, можно задавать дополнительные атрибуты для выбора оптимального маршрута.
> 
> **- генеалогические деревья**  
> Склоняюсь к реляционным БД (тот же PostgreSQL), обеспечивают связность данных. Но можно использовать и иерархическую или графовые БД. 
> 
> **- кэш идентификаторов клиентов с ограниченным временем жизни для движка аутентификации**  
> Key-Value БД (Redis/Memcached) с удалением данных по TTL.
> 
> **- отношения клиент-покупка для интернет-магазина**  
> Реляционные БД (PostgreSQL, MySQL), т.к. они обеспечат связанность данных между различными таблицами. 

---

### Задача 2
Вы создали распределённое высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт — это отдельная реализация вашей системы и для каждого пункта нужно привести классификацию):

- данные записываются на все узлы с задержкой до часа (асинхронная запись);
- при сетевых сбоях система может разделиться на 2 раздельных кластера;
- система может не прислать корректный ответ или сбросить соединение.

Согласно PACELC-теореме как бы вы классифицировали эти реализации?


> #### Ответ:
> - ***данные записываются на все узлы с задержкой до часа (асинхронная запись)***  
> Если правильно понял условие, каждый из узлов может принимать данные, но не обязуется в тот же момент времени поддерживать консистентность на всех узлах. Тогда:
>   - *(CAP):* По условию похоже на AP, либо CA, если имелось в виду, что активно поддерживается консистентность данных.
>   - *(PACELC):* PC/EL - при разделении стремится оставаться консистентной, а в случае без сетевых разделений, фокусируется на скорости ответа, отводя консистентность на второй план.
> 
> - ***при сетевых сбоях система может разделиться на 2 раздельных кластера***  
> получается, что система устойчива к разделению и при этом её данные доступны, но не консистентны между кластерами в момент времени.
>   - *(CAP):* AP - не гарантирует целостность данных, обеспечивая их доступность и устойчивость к разделению. 
>   - *(PACELC):* PA/EL - Данные доступны, но не согласованы для всех узлов  
> 
> - ***система может не прислать корректный ответ или сбросить соединение***
>   - *(CAP):* CP - система, где в случае сбоя запросы могут отбраковываться, т.е. доступность не соблюдается.  
>   - *(PACELC):* PC/EC - вне зависимости от разделения ставка делается на консистентность.

---

### Задача 3
Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?


> #### Ответ:
> ACID-принципы стремятся обеспечить согласованность данных, гарантируя атомарность, целостность, изолированность и 
> долговечность транзакций. В этом случае данные считаются достоверными и согласованными в любой момент времени.  
> BASE-принципы, с другой стороны, фокусируются на обеспечении доступности, возможности работать в режиме 
> мягкого состояния и конечной согласованности. Это означает, что система может оставаться доступной и функционировать, 
> даже если она находится в мягком, не полностью согласованном состоянии на определенном этапе.  
> Принципы BASE и ACID сочетаться не могут, так как по BASE - данные могут быть несогласованны, а в ACID - требуется согласованность данных.
---

### Задача 4
Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни,
- реакция на истечение таймаута.

Вы слышали о key-value-хранилище, которое имеет механизм Pub/Sub. 
Что это за система? Какие минусы выбора этой системы?


> #### Ответ:
> Redis - key-value хранилище с механизмом Pub/Sub, т.е. предоставляет возможность хранить данные в виде пар ключ-значение 
> и подписываться на определенные события, т.е. легковесная версия брокера сообщений вроде Kafka/RabbitMQ
> Минусы:
> - Тривиальная модель pub/sub:
>   - если издатель по каким-либо причинам выходит из строя, то он теряет всех своих подписчиков;
>   - нет очередей, т.е. издатель может перегрузить работой своих подписчиков, если данные публикуются быстрее, чем обрабатываются;
>   - сообщение удаляется из буфера издателя сразу после публикации, не зависимо от того, какому числу подписчиков оно доставлено и как быстро те сумели обработать это сообщение;
>   - все подписчики получат сообщение одновременно. Подписчики сами должны как-то между собой согласовывать порядок обработки одного и того же сообщения;
>   - нет встроенного механизма подтверждения успешной обработки сообщения подписчиком. Если подписчик получил сообщение и свалился во время обработки, то издатель об этом не узнает;
> - **Сложность масштабирования** (по сравнению с кластерными решениями брокеров RabbitMQ и Kafka);
> - **Однопоточная архитектура** - не справится с большой нагрузкой;
> - **Целостность данных** - т.к. данные хранятся в памяти, то в случае отказа сервера они могут быть утеряны
> - Для больших объемов появляются **высокие требования к ОЗУ** сервера
> - **Контроль доступа** - тривиальная система контроля доступа, только логин/пароль
---