# Домашнее задание к занятию "Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения" - `Александр Недорезов`

### Задача 1

Опишите кратко, в чём основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.

> #### Ответ:
> Главное отличие кратко - взаимодействие с ресурсами хоста. Не совсем правильно различать их только по типу гипервизора, 
> т.к. для паравиртуализации и полной виртуализации возможны и 1 тип Bare—Metal (гипервизор берет на себя роль хостовой ОС), и 2 тип Hosted (поверх хостовой ОС) гипервизоров, а некоторые вендоры поддерживают оба типа виртуализации для продукта. 
> 
> 
> Полная виртуализация - 
> * гипервизор - в случае hardware-assisted (Intel VT-x и AMD-V) это может быть и Bare-Metal (например, WMware ESXi), и Hosted (VirtualBox, VMware Workstation)
> * гостевая ОС не модифицируется, напрямую взаимодействует с ресурсами хоста (тип hardware-assisted, благодаря Intel VT-x и AMD-V), либо, в основном на старых процессорах, взаимодействует через двоичную трансляцию (тип software-assisted)
> * гостевая ОС не знает, что она виртуализируется.
> 
> Паравиртуализация -  
> * гипервизор - Bare-Metal (например, Xen) или Hosted (KVM, хотя его можно причислить и к Bare-Metal)
> * гостевая ОС модифицируется, чтобы позволить всем гостевым ОС в системе совместно использовать ресурсы хоста, а не эмулировать аппаратную инфраструктуру, что избавляет ВМ от необходимости перехватывать инструкции гипервизора, предназначенные для этой ВМ.
> * гостевая ОС знает, что она виртуализируется.  
> 
> Виртуализация уровня ОС - 
> * не существует отдельного слоя гипервизора, т.к. ОС хоста выполняет его функции 
> * гостевая система - контейнеры, изолированные на уровне операционной системы в пространствах (namespaces), что не позволяет запускать гостевые ОС с ядрами, отличными от ядра хостовой ОС. Все контейнеры используют ядро хоста
> * хостовая операционная система отвечает за разделение аппаратных ресурсов между контейнерами и обеспечивает их независимость.
---

### Задача 2

Выберите один из вариантов использования организации физических серверов в зависимости от условий использования.

Организация серверов:

* физические сервера,
* паравиртуализация,
* виртуализация уровня ОС.

Условия использования:

* высоконагруженная база данных, чувствительная к отказу;
* различные web-приложения;
* Windows-системы для использования бухгалтерским отделом;
* системы, выполняющие высокопроизводительные расчёты на GPU.

Опишите, почему вы выбрали к каждому целевому использованию такую организацию.

> #### Ответ:
> | Условия использования                                      | Организация серверов                | Пояснение                                                                                                                                                                                                                                                                                                                                                                                                        |
> |------------------------------------------------------------|-------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
> | Высоконагруженная база данных, чувствительная к отказу     | физические сервера                  | Система всего одна, поэтому виртуализация - оверхед и увеличивает латентность. В высоконагруженной системе это нежелательно, а достичь отказоустойчивости можно резервированием. Постоянно нагруженной системе потребуется максимум ресурсов хоста, "соседи" могут их отбирать.                                                                                                                                  |
> | Различные web-приложения                                   | виртуализация уровня ОС             | Бест практис для веб-приложений - разворачивать часто и быстро, на хосте или или кластере хостов с оркестрацией, при этом нужно обеспечить их изоляцию друг от друга. Виртуализация ОС подходит лучше всего, так свернуть приложение в контейнер и развернуть из него быстрей, чем делать это с виртуальными машинами с полноценной ОС и отдельным ядром.                                                        |
> | Windows системы для использования бухгалтерским отделом    | паравиртуализация                   | Виртуализация поможет системе быть более отказоустойчивой, из предложенных вариантов возможна только паравиртуализация, но я бы для Windows выбрал полную hardware-assisted виртуализацию, т.к. преимущества паравиртуализации в современных реалиях теряются                                                                                                                                                    |
> | Системы, выполняющие высокопроизводительные расчеты на GPU | физ.сервера/виртуализация уровня ОС | Зависит от целей. Если систем одна/мало - лучше физический сервер, который будет утилизировать все ресурсы самостоятельно. Если систем много (куча микросервисов с машинным обучением), то виртуализация средствами ОС предпочтительна, т.к. можно использовать GPU. Если же это какие-то а-ля игровые сервера, то из "не предложенных" - полная виртуализация VMWare ESXi, которая поддерживает технологию vGPU |

---

### Задача 3

Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

Сценарии:

1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based-инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.  
2. Требуется наиболее производительное бесплатное open source-решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.  
3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows-инфраструктуры.  
4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.  

> #### Ответ:
> 1. VMWare ESXi и Hyper-V обладают нужным функционалом. Учитывая Windows-based ориентацию инфраструктуры, то Hyper-V подойдёт лучше, но шире функционал у VMWare ESXi 
> 2. KVM - наиболее производительное решение, позволяет запускать Windows и Linux, опенсорсный, нетребовательный к ресурсам и довольно функциональный. Можно также использовать Xen - он бесплатный и опен-сорсный, но по бенчмаркам медленнее
> 3. Лучше использовать Hyper-V, так как он наиболее адаптирован под семейство Windows и начиная с Win 10 предустановлен в ОС.
> 4. KVM бесплатен и входит в состав ядра линукс. Но обычно тестирование необходимо автоматизировать, а это достигается через CI/CD, поэтому правильнее будет использовать Docker-контейнеры, ну либо поды k8s. Если же это что-то десктопное и ручное, то наверное можно и VirtualBox+Vagrant для быстрого поднятия тестовых машин  

---

### Задача 4

Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

> #### Ответ:
> Основные проблемы гетерогенной среды: 
> * увеличиваются требования к персоналу в части навыков эксплуатации разнородного ПО виртуализации,
> * увеличиваются операционные расходы в случае использования нескольких проприетарных систем управления виртуализацией,
> * усложняются операции по переносу виртуальных машин между различными средами и масштабирование.
> 
> Но, кажется, её сложно избежать. В основном организации, особенно крупные, работают в гибридной/гетерогенной среде. Часто остаются физические сервера - либо легаси, либо по требованию регуляторов (ФСБ, ФСТЭК, ЦБ). 
> Затем компания чаще всего выбирает пошаговую стратегию виртуализации ИТ-инфраструктуры, постепенно внедряя решения от различных производителей. Такой подход подразумевает, что определенные типы устройств выполняют соответственные задачи, и при этом компания не зависит от продукции одного вендора.
>   
> Для минимизации проблем нужно либо постараться перейти к однородной инфраструктуре, 
> либо уметь поддерживать все эти инфраструктуры, а также найти способ решить задачи по миграции виртуальных машин в случае, когда это понадобится, сделать процессы понятнее и прозрачнее для всех команд.
>   
> Если бизнес-процесс требует повышенной надежности (часть ресурсов локально, часть в облаке) или особых требований (регуляторы), то без гетерогенной среды не обойтись. 
> Надо освоиться в обеих средах и выработать практику работы с ними. Если такой задачи нет, то сама по себе гетерогенная среда "ради самой себя" или потому что "так сложилось" - это скорее проблема, от которой надо уйти. 
> Если такой задачи нет, то сама по себе гетерогенная среда "ради самой себя" или потому что "так сложилось" - это скорее проблема, от которой надо уйти. 
---